<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donuland Management System - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1900px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            padding: 20px 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            font-size: 0.9em;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 0 30px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #6c757d;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .nav-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: white;
        }
        
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .prediction-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .historical-match {
            background: #e8f6f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #27ae60;
            font-size: 0.9em;
        }
        
        .prediction-results {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }
        
        .big-number {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .prediction-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .detail-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid rgba(255,255,255,0.3);
        }
        
        .detail-card h4 {
            color: white;
            margin-bottom: 10px;
        }
        
        .detail-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #f1c40f;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .historical-insights {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .insight-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .confidence-meter {
            background: #e9ecef;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            transition: width 0.3s ease;
        }
        
        @media (max-width: 1200px) {
            .prediction-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .nav-tabs {
                padding: 0 15px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üç© Donuland Management System Enhanced</h1>
            <div class="header-controls">
                <div class="sync-status">
                    <div class="status-indicator"></div>
                    <span>Data naƒçtena</span>
                </div>
                <button class="btn btn-primary" onclick="loadHistoricalData()">
                    üìä Obnovit data
                </button>
            </div>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('prediction')">
                ü§ñ AI Predikce
            </div>
            <div class="nav-tab" onclick="showTab('insights')">
                üìà Historick√© trendy
            </div>
            <div class="nav-tab" onclick="showTab('analytics')">
                üìä Analytika
            </div>
            <div class="nav-tab" onclick="showTab('settings')">
                ‚öôÔ∏è Nastaven√≠
            </div>
        </div>
        
        <div class="content-area">
            <!-- AI Predikce Tab -->
            <div id="prediction" class="tab-content active">
                <div class="prediction-grid">
                    <div class="form-section">
                        <h3>üéØ Z√°kladn√≠ informace akce</h3>
                        
                        <div class="form-group">
                            <label for="eventType">Typ akce</label>
                            <select id="eventType" onchange="findSimilarEvents()">
                                <option value="">Vyberte typ akce</option>
                                <option value="food festival">Food festival</option>
                                <option value="veletrh">Veletrh (ƒåokoFest, Hobby)</option>
                                <option value="koncert">Koncert/Hudebn√≠ festival</option>
                                <option value="Sportovn√≠ akce (dospƒõl√≠)">Sportovn√≠ akce</option>
                                <option value="kulturn√≠ akce (rodinn√°)">Kulturn√≠/Rodinn√° akce</option>
                                <option value="rodinn√Ω festival">Rodinn√Ω festival</option>
                                <option value="ostatn√≠">Ostatn√≠</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="eventName">N√°zev akce</label>
                            <input type="text" id="eventName" placeholder="nap≈ô. Burger Fest Praha" oninput="findSimilarEvents()">
                            <div id="historicalMatch" class="historical-match" style="display: none;"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventLocation">Mƒõsto/Lokalita</label>
                                <select id="eventLocation" onchange="findSimilarEvents()">
                                    <option value="">Vyberte mƒõsto</option>
                                    <option value="Praha">Praha</option>
                                    <option value="Brno">Brno</option>
                                    <option value="Ostrava">Ostrava</option>
                                    <option value="Plze≈à">Plze≈à</option>
                                    <option value="ƒåesk√© Budƒõjovice">ƒåesk√© Budƒõjovice</option>
                                    <option value="Hradec Kr√°lov√©">Hradec Kr√°lov√©</option>
                                    <option value="Liberec">Liberec</option>
                                    <option value="Pardubice">Pardubice</option>
                                    <option value="Olomouc">Olomouc</option>
                                    <option value="jin√©">Jin√© mƒõsto</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="eventDate">Datum akce</label>
                                <input type="date" id="eventDate" onchange="findSimilarEvents()">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventDuration">D√©lka akce (dny)</label>
                                <select id="eventDuration">
                                    <option value="1">1 den</option>
                                    <option value="2" selected>2 dny</option>
                                    <option value="3">3 dny</option>
                                    <option value="4">4 dny</option>
                                    <option value="5">5 dn√≠</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="expectedVisitors">Oƒçek√°van√° n√°v≈°tƒõvnost</label>
                                <input type="number" id="expectedVisitors" value="5000" min="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="weather">Poƒças√≠</label>
                            <select id="weather">
                                <option value="sluneƒçno">‚òÄÔ∏è Sluneƒçno</option>
                                <option value="polojasno" selected>‚õÖ Polojasno</option>
                                <option value="oblaƒçno">‚òÅÔ∏è Oblaƒçno</option>
                                <option value="p≈ôeh√°≈àky">üå¶Ô∏è P≈ôeh√°≈àky</option>
                                <option value="d√©≈°t">üåßÔ∏è D√©≈°≈•</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>üí∞ Finanƒçn√≠ parametry</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="donutPrice">Cena donutu (Kƒç)</label>
                                <input type="number" id="donutPrice" value="45" min="0" step="5">
                            </div>
                            
                            <div class="form-group">
                                <label for="donutCost">N√°klady na donut (Kƒç)</label>
                                <input type="number" id="donutCost" value="18" min="0" step="1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="rentType">Typ n√°jmu</label>
                            <select id="rentType" onchange="updateRentFields()">
                                <option value="fixed">Fixn√≠ ƒç√°stka</option>
                                <option value="percent">Procenta z tr≈æby</option>
                                <option value="fixed_percent">Fixn√≠ + procenta</option>
                            </select>
                        </div>
                        
                        <div id="rentDetails">
                            <div class="form-group">
                                <label for="rentAmount">V√Ω≈°e n√°jmu (Kƒç)</label>
                                <input type="number" id="rentAmount" value="10000" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="travelCosts">N√°klady na cestu (Kƒç)</label>
                                <input type="number" id="travelCosts" value="500" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="otherCosts">Ostatn√≠ n√°klady (Kƒç)</label>
                                <input type="number" id="otherCosts" value="1000" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="staffCount">Poƒçet zamƒõstnanc≈Ø</label>
                                <select id="staffCount">
                                    <option value="1">1 zamƒõstnanec</option>
                                    <option value="2" selected>2 zamƒõstnanci</option>
                                    <option value="3">3 zamƒõstnanci</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="competition">Konkurence</label>
                                <select id="competition">
                                    <option value="0">≈Ω√°dn√° konkurence</option>
                                    <option value="1" selected>M√≠rn√° konkurence</option>
                                    <option value="2">St≈ôedn√≠ konkurence</option>
                                    <option value="3">Vysok√° konkurence</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="prediction-results" id="predictionResults" style="display: none;">
                        <h2>üéØ AI Predikce na z√°kladƒõ historick√Ωch dat</h2>
                        <div class="big-number" id="predictedSales">0</div>
                        <p>P≈ôedpokl√°dan√Ω prodej donut≈Ø za celou akci</p>
                        
                        <div style="margin: 20px 0;">
                            <div>Spolehlivost predikce:</div>
                            <div class="confidence-meter">
                                <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                            </div>
                            <div id="confidenceText">0% spolehlivost</div>
                        </div>
                        
                        <div class="prediction-details" id="predictionDetails">
                            <!-- Bude naplnƒõno JS -->
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button class="btn btn-success" onclick="saveEventToCalendar()">
                                üìÖ Ulo≈æit predikci
                            </button>
                            <button class="btn btn-warning" onclick="exportPrediction()">
                                üíæ Export predikce
                            </button>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="calculateAIPrediction()" style="width: 100%; margin-top: 20px; padding: 15px; font-size: 1.2em;">
                    ü§ñ Vytvo≈ôit AI predikci na z√°kladƒõ historick√Ωch dat
                </button>
            </div>
            
            <!-- Historick√© trendy Tab -->
            <div id="insights" class="tab-content">
                <div class="historical-insights">
                    <h3>üìà Kl√≠ƒçov√© poznatky z historick√Ωch dat</h3>
                    <div id="insightsList">
                        <!-- Bude naplnƒõno JS -->
                    </div>
                </div>
                
                <div class="stats-grid" id="trendStats">
                    <!-- Bude naplnƒõno JS -->
                </div>
            </div>
            
            <!-- Analytika Tab -->
            <div id="analytics" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalEventsAnalytics">0</div>
                        <div class="stat-label">Celkem akc√≠ v datech</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgSalesPerEvent">0</div>
                        <div class="stat-label">Pr≈Ømƒõr prodeje/akce</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="bestEventType">-</div>
                        <div class="stat-label">Nejlep≈°√≠ typ akce</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="bestLocation">-</div>
                        <div class="stat-label">Nejlep≈°√≠ lokalita</div>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">üìä Detailn√≠ anal√Ωza podle typu akce</h3>
                    <div id="eventTypeAnalysis">
                        <!-- Bude naplnƒõno JS -->
                    </div>
                </div>
            </div>
            
            <!-- Nastaven√≠ Tab -->
            <div id="settings" class="tab-content">
                <div style="max-width: 600px;">
                    <div class="form-section">
                        <h3>üìä Google Sheets integrace</h3>
                        
                        <div class="form-group">
                            <label for="sheetsUrl">URL Google Sheets</label>
                            <input type="url" id="sheetsUrl" 
                                   value="https://docs.google.com/spreadsheets/d/1LclCz9hb0hlb1D92OyVqk6Cbam7PRK6KgAzGgiGs6iE/edit?usp=sharing"
                                   placeholder="https://docs.google.com/spreadsheets/d/...">
                        </div>
                        
                        <button class="btn btn-primary" onclick="testSheetsConnection()">
                            üîó Testovat p≈ôipojen√≠
                        </button>
                        
                        <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 5px; padding: 15px; color: #0c5460; margin-top: 15px;">
                            <strong>Informace:</strong> Pro p≈ô√≠stup k Google Sheets je pot≈ôeba, aby byl dokument ve≈ôejn√Ω nebo sd√≠len√Ω.
                        </div>
                    </div>
                    
                    <div class="form-section" style="margin-top: 30px;">
                        <h3>‚öôÔ∏è Z√°kladn√≠ nastaven√≠</h3>
                        
                        <div class="form-group">
                            <label for="defaultDonutPrice">V√Ωchoz√≠ cena donutu (Kƒç)</label>
                            <input type="number" id="defaultDonutPrice" value="45" min="0" step="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="defaultDonutCost">V√Ωchoz√≠ n√°klady na donut (Kƒç)</label>
                            <input type="number" id="defaultDonutCost" value="18" min="0" step="1">
                        </div>
                        
                        <button class="btn btn-success" onclick="saveSettings()">
                            üíæ Ulo≈æit nastaven√≠
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Glob√°ln√≠ promƒõnn√©
        let historicalData = [];
        let currentPrediction = null;

        // Simulovan√° historick√° data na z√°kladƒõ va≈°eho Google Sheets
        const mockHistoricalData = [
            { date: "2025-05-10", location: "Plze≈à", eventName: "Burger Fest", category: "food festival", sold: 1438, weather: "polojasno", visitors: 5000, staff: 2, competition: 1, rating: 5 },
            { date: "2025-05-17", location: "Ostrava", eventName: "Burger Festival", category: "food festival", sold: 1563, weather: "d√©≈°t", visitors: 5000, staff: 3, competition: 1, rating: 5 },
            { date: "2025-05-11", location: "Mari√°nsk√© L√°znƒõ", eventName: "Zah√°jen√≠ l√°ze≈àsk√© sez√≥ny", category: "kulturn√≠ akce (rodinn√°)", sold: 665, weather: "sluneƒçno", visitors: 10000, staff: 2, competition: 3, rating: 5 },
            { date: "2025-05-17", location: "Ostrava", eventName: "Bezva Fest", category: "rodinn√Ω festival", sold: 413, weather: "d√©≈°≈•", visitors: 4000, staff: 2, competition: 1, rating: 5 },
            { date: "2025-05-17", location: "Vod≈àany", eventName: "Street food", category: "food festival", sold: 340, weather: "polojasno", visitors: 10000, staff: 1, competition: 1, rating: 5 },
            { date: "2025-05-17", location: "Plan√°", eventName: "Houkaƒçky", category: "kulturn√≠ akce (rodinn√°)", sold: 576, weather: "polojasno", visitors: 2000, staff: 2, competition: 1, rating: 5 },
            { date: "2025-04-18", location: "Hradec Kr√°lov√©", eventName: "Maj√°les", category: "koncert", sold: 330, weather: "polojasno", visitors: 20000, staff: 3, competition: 0, rating: 2 },
            { date: "2025-04-26", location: "Praha", eventName: "Maj√°les", category: "koncert", sold: 363, weather: "polojasno", visitors: 0, staff: 2, competition: 3, rating: 2 },
            { date: "2025-05-03", location: "Ostrava", eventName: "Maj√°les", category: "koncert", sold: 406, weather: "", visitors: 0, staff: 2, competition: 0, rating: 0 },
            { date: "2025-05-10", location: "Brno", eventName: "Maj√°les", category: "koncert", sold: 252, weather: "", visitors: 0, staff: 2, competition: 0, rating: 0 }
        ];

        // Inicializace aplikace
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('eventDate').value = tomorrow.toISOString().split('T')[0];
                
                loadSettings();
                loadHistoricalData();
            } catch (error) {
                console.error('Chyba p≈ôi inicializaci:', error);
                showMessage('Chyba p≈ôi naƒç√≠t√°n√≠ aplikace', 'error');
            }
        });

        // Naƒçten√≠ historick√Ωch dat
        function loadHistoricalData() {
            try {
                historicalData = mockHistoricalData;
                generateInsights();
                updateAnalytics();
                showMessage('Historick√° data byla naƒçtena', 'success');
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error);
                showMessage('Chyba p≈ôi naƒç√≠t√°n√≠ historick√Ωch dat', 'error');
            }
        }

        // Spr√°va tab≈Ø
        function showTab(tabName) {
            try {
                const tabs = document.querySelectorAll('.tab-content');
                tabs.forEach(tab => tab.classList.remove('active'));
                
                const navTabs = document.querySelectorAll('.nav-tab');
                navTabs.forEach(tab => tab.classList.remove('active'));
                
                document.getElementById(tabName).classList.add('active');
                event.target.classList.add('active');
                
                if (tabName === 'insights') {
                    generateInsights();
                } else if (tabName === 'analytics') {
                    updateAnalytics();
                }
            } catch (error) {
                console.error('Chyba p≈ôi p≈ôep√≠n√°n√≠ tab≈Ø:', error);
            }
        }

        // Hled√°n√≠ podobn√Ωch akc√≠
        function findSimilarEvents() {
            try {
                const eventType = document.getElementById('eventType').value;
                const eventName = document.getElementById('eventName').value.toLowerCase();
                const location = document.getElementById('eventLocation').value;
                
                if (!eventType && !eventName && !location) {
                    document.getElementById('historicalMatch').style.display = 'none';
                    return;
                }
                
                const matches = historicalData.filter(event => {
                    let score = 0;
                    if (eventType && event.category === eventType) score += 3;
                    if (eventName && event.eventName.toLowerCase().includes(eventName)) score += 2;
                    if (location && event.location === location) score += 1;
                    return score > 0;
                }).sort((a, b) => b.sold - a.sold);
                
                if (matches.length > 0) {
                    const match = matches[0];
                    const matchDiv = document.getElementById('historicalMatch');
                    matchDiv.innerHTML = `
                        <strong>üìä Podobn√° historick√° akce:</strong><br>
                        ${match.eventName} (${match.location})<br>
                        Prod√°no: <strong>${match.sold}</strong> donut≈Ø | Hodnocen√≠: ${match.rating}/5 ‚≠ê<br>
                        <small>Poƒças√≠: ${match.weather || 'nezn√°m√©'} | Zamƒõstnanci: ${match.staff}</small>
                    `;
                    matchDiv.style.display = 'block';
                } else {
                    document.getElementById('historicalMatch').style.display = 'none';
                }
            } catch (error) {
                console.error('Chyba p≈ôi hled√°n√≠ podobn√Ωch akc√≠:', error);
            }
        }

        // AI Predikce
        function calculateAIPrediction() {
            try {
                const eventType = document.getElementById('eventType').value;
                const eventName = document.getElementById('eventName').value;
                const location = document.getElementById('eventLocation').value;
                const expectedVisitors = parseInt(document.getElementById('expectedVisitors').value);
                const weather = document.getElementById('weather').value;
                const donutPrice = parseFloat(document.getElementById('donutPrice').value);
                const donutCost = parseFloat(document.getElementById('donutCost').value);
                const staffCount = parseInt(document.getElementById('staffCount').value);
                const competition = parseInt(document.getElementById('competition').value);
                
                if (!eventType || !eventName || !location) {
                    showMessage('Vypl≈àte pros√≠m v≈°echna z√°kladn√≠ pole', 'warning');
                    return;
                }
                
                // Naj√≠t podobn√© akce v historick√Ωch datech
                const similarEvents = historicalData.filter(event => 
                    event.category === eventType || 
                    event.location === location ||
                    event.eventName.toLowerCase().includes(eventName.toLowerCase())
                );
                
                let baseSales = 0;
                let confidence = 0;
                
                if (similarEvents.length > 0) {
                    // V√Ωpoƒçet na z√°kladƒõ podobn√Ωch akc√≠
                    const avgSales = similarEvents.reduce((sum, event) => sum + event.sold, 0) / similarEvents.length;
                    baseSales = Math.round(avgSales);
                    confidence = Math.min(90, 20 + (similarEvents.length * 15));
                } else {
                    // Z√°kladn√≠ v√Ωpoƒçet bez historick√Ωch dat
                    baseSales = Math.round(expectedVisitors * 0.1); // 10% n√°v≈°tƒõvn√≠k≈Ø
                    confidence = 30;
                }
                
                // Aplikace faktor≈Ø
                let weatherFactor = getWeatherFactor(weather);
                let competitionFactor = getCompetitionFactor(competition);
                let staffFactor = getStaffFactor(staffCount, expectedVisitors);
                
                const predictedSales = Math.round(baseSales * weatherFactor * competitionFactor * staffFactor);
                const revenue = predictedSales * donutPrice;
                const productionCost = predictedSales * donutCost;
                
                // N√°klady
                const rentCost = calculateRentCost(revenue);
                const travelCosts = parseFloat(document.getElementById('travelCosts').value);
                const otherCosts = parseFloat(document.getElementById('otherCosts').value);
                
                const totalCosts = productionCost + rentCost + travelCosts + otherCosts;
                const profit = revenue - totalCosts;
                
                currentPrediction = {
                    predictedSales,
                    revenue,
                    profit,
                    totalCosts,
                    confidence,
                    weatherFactor,
                    competitionFactor,
                    staffFactor
                };
                
                displayPredictionResults(currentPrediction);
                
            } catch (error) {
                console.error('Chyba p≈ôi v√Ωpoƒçtu predikce:', error);
                showMessage('Chyba p≈ôi v√Ωpoƒçtu predikce', 'error');
            }
        }

        // Pomocn√© funkce pro faktory
        function getWeatherFactor(weather) {
            const factors = {
                'sluneƒçno': 1.2,
                'polojasno': 1.0,
                'oblaƒçno': 0.9,
                'p≈ôeh√°≈àky': 0.7,
                'd√©≈°t': 0.6
            };
            return factors[weather] || 1.0;
        }

        function getCompetitionFactor(competition) {
            const factors = [1.0, 0.9, 0.8, 0.6]; // 0=≈æ√°dn√°, 1=m√≠rn√°, 2=st≈ôedn√≠, 3=vysok√°
            return factors[competition] || 1.0;
        }

        function getStaffFactor(staffCount, expectedVisitors) {
            const optimalRatio = expectedVisitors / 3000; // 1 zamƒõstnanec na 3000 n√°v≈°tƒõvn√≠k≈Ø
            if (staffCount < optimalRatio) return 0.85; // M√°lo zamƒõstnanc≈Ø
            if (staffCount > optimalRatio * 1.5) return 0.95; // Moc zamƒõstnanc≈Ø
            return 1.0;
        }

        function calculateRentCost(revenue) {
            const rentType = document.getElementById('rentType').value;
            const rentAmount = parseFloat(document.getElementById('rentAmount').value);
            
            switch (rentType) {
                case 'fixed':
                    return rentAmount;
                case 'percent':
                    return revenue * (rentAmount / 100);
                case 'fixed_percent':
                    return rentAmount + (revenue * 0.05); // 5% z tr≈æby + fixn√≠ ƒç√°st
                default:
                    return rentAmount;
            }
        }

        // Zobrazen√≠ v√Ωsledk≈Ø predikce
        function displayPredictionResults(results) {
            try {
                document.getElementById('predictedSales').textContent = results.predictedSales.toLocaleString();
                document.getElementById('confidenceFill').style.width = results.confidence + '%';
                document.getElementById('confidenceText').textContent = results.confidence + '% spolehlivost';
                
                const detailsDiv = document.getElementById('predictionDetails');
                detailsDiv.innerHTML = `
                    <div class="detail-card">
                        <h4>üí∞ Tr≈æba</h4>
                        <div class="value">${results.revenue.toLocaleString()} Kƒç</div>
                    </div>
                    <div class="detail-card">
                        <h4>üí∏ N√°klady</h4>
                        <div class="value">${results.totalCosts.toLocaleString()} Kƒç</div>
                    </div>
                    <div class="detail-card">
                        <h4>üìà Zisk</h4>
                        <div class="value" style="color: ${results.profit > 0 ? '#27ae60' : '#e74c3c'}">
                            ${results.profit.toLocaleString()} Kƒç
                        </div>
                    </div>
                    <div class="detail-card">
                        <h4>üå§Ô∏è Vliv poƒças√≠</h4>
                        <div class="value">${(results.weatherFactor * 100).toFixed(0)}%</div>
                    </div>
                    <div class="detail-card">
                        <h4>üè™ Vliv konkurence</h4>
                        <div class="value">${(results.competitionFactor * 100).toFixed(0)}%</div>
                    </div>
                    <div class="detail-card">
                        <h4>üë• Person√°ln√≠ faktor</h4>
                        <div class="value">${(results.staffFactor * 100).toFixed(0)}%</div>
                    </div>
                `;
                
                document.getElementById('predictionResults').style.display = 'block';
                document.getElementById('predictionResults').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Chyba p≈ôi zobrazen√≠ v√Ωsledk≈Ø:', error);
            }
        }

        // Generov√°n√≠ poznatk≈Ø
        function generateInsights() {
            try {
                if (historicalData.length === 0) {
                    document.getElementById('insightsList').innerHTML = `
                        <p style="text-align: center; color: #6c757d; padding: 40px;">
                            Naƒçtƒõte historick√° data pro zobrazen√≠ trend≈Ø a poznatk≈Ø
                        </p>
                    `;
                    return;
                }
                
                const insights = [];
                
                // Anal√Ωza podle typu akce
                const eventTypes = {};
                historicalData.forEach(event => {
                    if (!eventTypes[event.category]) {
                        eventTypes[event.category] = { total: 0, count: 0, avgRating: 0 };
                    }
                    eventTypes[event.category].total += event.sold;
                    eventTypes[event.category].count += 1;
                    eventTypes[event.category].avgRating += event.rating;
                });
                
                let bestType = '';
                let bestAvg = 0;
                for (const [type, data] of Object.entries(eventTypes)) {
                    const avg = data.total / data.count;
                    if (avg > bestAvg) {
                        bestAvg = avg;
                        bestType = type;
                    }
                }
                
                insights.push(`Nejlep≈°√≠ typ akce: <strong>${bestType}</strong> s pr≈Ømƒõrem <strong>${Math.round(bestAvg)}</strong> donut≈Ø na akci`);
                
                // Anal√Ωza podle poƒças√≠
                const weatherStats = {};
                historicalData.forEach(event => {
                    if (event.weather) {
                        if (!weatherStats[event.weather]) {
                            weatherStats[event.weather] = { total: 0, count: 0 };
                        }
                        weatherStats[event.weather].total += event.sold;
                        weatherStats[event.weather].count += 1;
                    }
                });
                
                let bestWeather = '';
                let bestWeatherAvg = 0;
                for (const [weather, data] of Object.entries(weatherStats)) {
                    const avg = data.total / data.count;
                    if (avg > bestWeatherAvg) {
                        bestWeatherAvg = avg;
                        bestWeather = weather;
                    }
                }
                
                if (bestWeather) {
                    insights.push(`Nejlep≈°√≠ poƒças√≠ pro prodej: <strong>${bestWeather}</strong> (pr≈Ømƒõr ${Math.round(bestWeatherAvg)} donut≈Ø)`);
                }
                
                // Anal√Ωza podle lokality
                const locationStats = {};
                historicalData.forEach(event => {
                    if (!locationStats[event.location]) {
                        locationStats[event.location] = { total: 0, count: 0 };
                    }
                    locationStats[event.location].total += event.sold;
                    locationStats[event.location].count += 1;
                });
                
                let bestLocation = '';
                let bestLocationAvg = 0;
                for (const [location, data] of Object.entries(locationStats)) {
                    const avg = data.total / data.count;
                    if (avg > bestLocationAvg && data.count > 1) { // Alespo≈à 2 akce
                        bestLocationAvg = avg;
                        bestLocation = location;
                    }
                }
                
                if (bestLocation) {
                    insights.push(`Nejlep≈°√≠ lokalita: <strong>${bestLocation}</strong> (pr≈Ømƒõr ${Math.round(bestLocationAvg)} donut≈Ø na akci)`);
                }
                
                // Top akce
                const topEvent = historicalData.reduce((max, event) => 
                    event.sold > max.sold ? event : max, historicalData[0]);
                
                insights.push(`Nej√∫spƒõ≈°nƒõj≈°√≠ akce: <strong>${topEvent.eventName}</strong> v ${topEvent.location} (${topEvent.sold} donut≈Ø)`);
                
                // Zobrazen√≠ poznatk≈Ø
                const insightsList = document.getElementById('insightsList');
                insightsList.innerHTML = insights.map(insight => 
                    `<div class="insight-item">${insight}</div>`
                ).join('');
                
            } catch (error) {
                console.error('Chyba p≈ôi generov√°n√≠ poznatk≈Ø:', error);
            }
        }

        // Aktualizace analytiky
        function updateAnalytics() {
            try {
                if (historicalData.length === 0) {
                    document.getElementById('totalEventsAnalytics').textContent = '0';
                    document.getElementById('avgSalesPerEvent').textContent = '0';
                    document.getElementById('bestEventType').textContent = '-';
                    document.getElementById('bestLocation').textContent = '-';
                    return;
                }
                
                const totalEvents = historicalData.length;
                const totalSales = historicalData.reduce((sum, event) => sum + event.sold, 0);
                const avgSales = Math.round(totalSales / totalEvents);
                
                document.getElementById('totalEventsAnalytics').textContent = totalEvents;
                document.getElementById('avgSalesPerEvent').textContent = avgSales;
                
                // Nejlep≈°√≠ typ akce
                const eventTypes = {};
                historicalData.forEach(event => {
                    if (!eventTypes[event.category]) {
                        eventTypes[event.category] = { total: 0, count: 0 };
                    }
                    eventTypes[event.category].total += event.sold;
                    eventTypes[event.category].count += 1;
                });
                
                let bestType = '';
                let bestTypeAvg = 0;
                for (const [type, data] of Object.entries(eventTypes)) {
                    const avg = data.total / data.count;
                    if (avg > bestTypeAvg) {
                        bestTypeAvg = avg;
                        bestType = type;
                    }
                }
                
                document.getElementById('bestEventType').textContent = bestType || '-';
                
                // Nejlep≈°√≠ lokalita
                const locationStats = {};
                historicalData.forEach(event => {
                    if (!locationStats[event.location]) {
                        locationStats[event.location] = { total: 0, count: 0 };
                    }
                    locationStats[event.location].total += event.sold;
                    locationStats[event.location].count += 1;
                });
                
                let bestLocation = '';
                let bestLocationAvg = 0;
                for (const [location, data] of Object.entries(locationStats)) {
                    const avg = data.total / data.count;
                    if (avg > bestLocationAvg) {
                        bestLocationAvg = avg;
                        bestLocation = location;
                    }
                }
                
                document.getElementById('bestLocation').textContent = bestLocation || '-';
                
                // Detailn√≠ anal√Ωza podle typu akce
                const analysisDiv = document.getElementById('eventTypeAnalysis');
                let analysisHTML = '';
                
                for (const [type, data] of Object.entries(eventTypes)) {
                    const avg = Math.round(data.total / data.count);
                    const percentage = ((data.total / totalSales) * 100).toFixed(1);
                    
                    analysisHTML += `
                        <div style="padding: 15px; border-bottom: 1px solid #f8f9fa; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${type}</strong><br>
                                <small style="color: #6c757d;">${data.count} ${data.count === 1 ? 'akce' : 'akc√≠'}</small>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.2em; color: #3498db; font-weight: bold;">
                                    ${avg} donut≈Ø
                                </div>
                                <small style="color: #6c757d;">${percentage}% celkov√©ho prodeje</small>
                            </div>
                        </div>
                    `;
                }
                
                analysisDiv.innerHTML = analysisHTML;
                
            } catch (error) {
                console.error('Chyba p≈ôi aktualizaci analytiky:', error);
            }
        }

        // Aktualizace pol√≠ n√°jmu
        function updateRentFields() {
            try {
                const rentType = document.getElementById('rentType').value;
                const rentDetails = document.getElementById('rentDetails');
                
                let html = '';
                switch (rentType) {
                    case 'fixed':
                        html = `
                            <div class="form-group">
                                <label for="rentAmount">Fixn√≠ n√°jem (Kƒç)</label>
                                <input type="number" id="rentAmount" value="10000" min="0">
                            </div>
                        `;
                        break;
                    case 'percent':
                        html = `
                            <div class="form-group">
                                <label for="rentAmount">Procenta z tr≈æby (%)</label>
                                <input type="number" id="rentAmount" value="15" min="0" max="50" step="0.5">
                            </div>
                        `;
                        break;
                    case 'fixed_percent':
                        html = `
                            <div class="form-group">
                                <label for="rentAmount">Fixn√≠ ƒç√°st n√°jmu (Kƒç)</label>
                                <input type="number" id="rentAmount" value="5000" min="0">
                            </div>
                            <div class="form-group">
                                <label>+ 5% z tr≈æby</label>
                                <input type="text" value="5% z tr≈æby" disabled>
                            </div>
                        `;
                        break;
                }
                
                rentDetails.innerHTML = html;
            } catch (error) {
                console.error('Chyba p≈ôi aktualizaci pol√≠ n√°jmu:', error);
            }
        }

        // Ulo≈æen√≠ predikce
        function saveEventToCalendar() {
            try {
                if (!currentPrediction) {
                    showMessage('Nejprve vytvo≈ôte predikci', 'warning');
                    return;
                }
                
                const eventData = {
                    name: document.getElementById('eventName').value,
                    type: document.getElementById('eventType').value,
                    location: document.getElementById('eventLocation').value,
                    date: document.getElementById('eventDate').value,
                    prediction: currentPrediction,
                    timestamp: new Date().toISOString()
                };
                
                // Simulace ulo≈æen√≠
                const savedPredictions = JSON.parse(localStorage.getItem('donulandPredictions') || '[]');
                savedPredictions.push(eventData);
                localStorage.setItem('donulandPredictions', JSON.stringify(savedPredictions));
                
                showMessage('Predikce byla ulo≈æena', 'success');
            } catch (error) {
                console.error('Chyba p≈ôi ukl√°d√°n√≠ predikce:', error);
                showMessage('Chyba p≈ôi ukl√°d√°n√≠ predikce', 'error');
            }
        }

        // Export predikce
        function exportPrediction() {
            try {
                if (!currentPrediction) {
                    showMessage('Nejprve vytvo≈ôte predikci', 'warning');
                    return;
                }
                
                const exportData = {
                    eventName: document.getElementById('eventName').value,
                    eventType: document.getElementById('eventType').value,
                    location: document.getElementById('eventLocation').value,
                    date: document.getElementById('eventDate').value,
                    prediction: currentPrediction,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `predikce_${document.getElementById('eventName').value.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showMessage('Predikce byla exportov√°na', 'success');
            } catch (error) {
                console.error('Chyba p≈ôi exportu:', error);
                showMessage('Chyba p≈ôi exportu predikce', 'error');
            }
        }

        // Test p≈ôipojen√≠ k Google Sheets
        function testSheetsConnection() {
            try {
                const url = document.getElementById('sheetsUrl').value;
                
                if (!url) {
                    showMessage('Zadejte URL Google Sheets', 'warning');
                    return;
                }
                
                // Simulace testu p≈ôipojen√≠
                showMessage('Testov√°n√≠ p≈ôipojen√≠...', 'info');
                
                setTimeout(() => {
                    if (url.includes('docs.google.com/spreadsheets')) {
                        showMessage('P≈ôipojen√≠ k Google Sheets je funkƒçn√≠', 'success');
                    } else {
                        showMessage('Neplatn√© URL Google Sheets', 'error');
                    }
                }, 1500);
                
            } catch (error) {
                console.error('Chyba p≈ôi testov√°n√≠ p≈ôipojen√≠:', error);
                showMessage('Chyba p≈ôi testov√°n√≠ p≈ôipojen√≠', 'error');
            }
        }

        // Naƒçten√≠ nastaven√≠
        function loadSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem('donulandSettings') || '{}');
                
                if (settings.defaultDonutPrice) {
                    document.getElementById('defaultDonutPrice').value = settings.defaultDonutPrice;
                    document.getElementById('donutPrice').value = settings.defaultDonutPrice;
                }
                
                if (settings.defaultDonutCost) {
                    document.getElementById('defaultDonutCost').value = settings.defaultDonutCost;
                    document.getElementById('donutCost').value = settings.defaultDonutCost;
                }
                
                if (settings.sheetsUrl) {
                    document.getElementById('sheetsUrl').value = settings.sheetsUrl;
                }
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ nastaven√≠:', error);
            }
        }

        // Ulo≈æen√≠ nastaven√≠
        function saveSettings() {
            try {
                const settings = {
                    defaultDonutPrice: parseFloat(document.getElementById('defaultDonutPrice').value),
                    defaultDonutCost: parseFloat(document.getElementById('defaultDonutCost').value),
                    sheetsUrl: document.getElementById('sheetsUrl').value
                };
                
                localStorage.setItem('donulandSettings', JSON.stringify(settings));
                
                // Aktualizace hodnot ve formul√°≈ôi
                document.getElementById('donutPrice').value = settings.defaultDonutPrice;
                document.getElementById('donutCost').value = settings.defaultDonutCost;
                
                showMessage('Nastaven√≠ bylo ulo≈æeno', 'success');
            } catch (error) {
                console.error('Chyba p≈ôi ukl√°d√°n√≠ nastaven√≠:', error);
                showMessage('Chyba p≈ôi ukl√°d√°n√≠ nastaven√≠', 'error');
            }
        }

        // Zobrazen√≠ zpr√°v
        function showMessage(text, type = 'info') {
            try {
                // Odstranit existuj√≠c√≠ zpr√°vy
                const existingMessages = document.querySelectorAll('.message');
                existingMessages.forEach(msg => msg.remove());
                
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                
                document.body.appendChild(message);
                
                // Automatick√© odstranƒõn√≠ po 4 sekund√°ch
                setTimeout(() => {
                    if (message.parentNode) {
                        message.remove();
                    }
                }, 4000);
                
                // Kliknut√≠ pro ruƒçn√≠ odstranƒõn√≠
                message.onclick = () => message.remove();
            } catch (error) {
                console.error('Chyba p≈ôi zobrazen√≠ zpr√°vy:', error);
            }
        }
    </script>
</body>
</html>
