// =============================================================================
        // UTILITY FUNCTIONS AND ERROR HANDLING
        // =============================================================================

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showMessage('Do≈°lo k neoƒçek√°van√© chybƒõ aplikace', 'error');
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            showMessage('Chyba p≈ôi komunikaci se serverem', 'error');
        });

        // Auto-save form data on input (debounced)
        let autoSaveTimeout;
        function autoSaveFormData() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                const formData = {
                    eventType: document.getElementById('eventType').value,
                    eventName: document.getElementById('eventName').value,
                    eventLocation: document.getElementById('eventLocation').value,
                    eventDate: document.getElementById('eventDate').value,
                    eventDuration: document.getElementById('eventDuration').value,
                    expectedVisitors: document.getElementById('expectedVisitors').value,
                    eventEnvironment: document.getElementById('eventEnvironment').value,
                    businessModel: document.querySelector('input[name="businessModel"]:checked').value,
                    savedAt: new Date().toISOString()
                };
                localStorage.setItem('donulandFormDraft', JSON.stringify(formData));
            }, 2000);
        }

        // Load saved form data on page load
        function loadFormDraft() {
            const saved = localStorage.getItem('donulandFormDraft');
            if (saved) {
                try {
                    const formData = JSON.parse(saved);
                    const savedDate = new Date(formData.savedAt);
                    const hoursSinceLastSave = (new Date() - savedDate) / (1000 * 60 * 60);
                    
                    // Only restore if saved within last 24 hours
                    if (hoursSinceLastSave < 24) {
                        document.getElementById('eventType').value = formData.eventType || '';
                        document.getElementById('eventName').value = formData.eventName || '';
                        document.getElementById('eventLocation').value = formData.eventLocation || '';
                        document.getElementById('eventDate').value = formData.eventDate || '';
                        document.getElementById('eventDuration').value = formData.eventDuration || '2';
                        document.getElementById('expectedVisitors').value = formData.expectedVisitors || '2000';
                        document.getElementById('eventEnvironment').value = formData.eventEnvironment || 'outdoor';
                        
                        if (formData.businessModel) {
                            const radioButton = document.querySelector(`input[name="businessModel"][value="${formData.businessModel}"]`);
                            if (radioButton) radioButton.checked = true;
                        }
                        
                        showMessage('Obnoveny rozpracovan√© √∫daje', 'info');
                    }
                } catch (e) {
                    console.error('Error loading form draft:', e);
                }
            }
        }

        // Setup auto-save listeners
        function setupAutoSave() {
            const inputs = ['eventType', 'eventName', 'eventLocation', 'eventDate', 'eventDuration', 'expectedVisitors', 'eventEnvironment'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', autoSaveFormData);
                    element.addEventListener('change', autoSaveFormData);
                }
            });
            
            document.querySelectorAll('input[name="businessModel"]').forEach(radio => {
                radio.addEventListener('change', autoSaveFormData);
            });
        }

        // Cleanup function
        function cleanup() {
            // Clear auto-save timeout
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            // Clear any intervals
            // Auto-refresh interval is already handled in loadData setup
        }

        // Setup cleanup on page unload
        window.addEventListener('beforeunload', cleanup);

        // Add to initialization
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing initialization code ...
            setupAutoSave();
            loadFormDraft();
        });

        // =============================================================================
        // KEYBOARD SHORTCUTS
        // =============================================================================

        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save prediction
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (lastPrediction) {
                    saveCurrentPrediction();
                }
            }
            
            // Ctrl/Cmd + R to reset form
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                if (confirm('Opravdu chcete vymazat formul√°≈ô?')) {
                    resetForm();
                }
            }
            
            // ESC to close modal
            if (e.key === 'Escape') {
                const modal = document.getElementById('eventModal');
                if (modal && modal.style.display === 'block') {
                    closeEventModal();
                }
            }
        });

        // =============================================================================
        // PERFORMANCE MONITORING
        // =============================================================================

        // Simple performance tracking
        function trackPerformance(action, startTime) {
            const endTime = performance.now();
            const duration = endTime - startTime;
            console.log(`‚è±Ô∏è ${action} took ${duration.toFixed(2)}ms`);
            
            // Log slow operations
            if (duration > 1000) {
                console.warn(`‚ö†Ô∏è Slow operation detected: ${action} (${duration.toFixed(2)}ms)`);
            }
        }

        // =============================================================================
        // ACCESSIBILITY IMPROVEMENTS
        // =============================================================================

        // Add ARIA labels and improve keyboard navigation
        function enhanceAccessibility() {
            // Add skip link for keyboard users
            const skipLink = document.createElement('a');
            skipLink.href = '#prediction';
            skipLink.textContent = 'P≈ôej√≠t na hlavn√≠ obsah';
            skipLink.style.cssText = `
                position: absolute;
                top: -40px;
                left: 6px;
                background: #000;
                color: #fff;
                padding: 8px;
                text-decoration: none;
                z-index: 1000;
                border-radius: 4px;
            `;
            skipLink.addEventListener('focus', () => {
                skipLink.style.top = '6px';
            });
            skipLink.addEventListener('blur', () => {
                skipLink.style.top = '-40px';
            });
            document.body.insertBefore(skipLink, document.body.firstChild);
            
            // Improve form labels
            document.querySelectorAll('input, select').forEach(element => {
                if (!element.getAttribute('aria-describedby') && element.nextElementSibling) {
                    const describedBy = element.id + '-desc';
                    element.setAttribute('aria-describedby', describedBy);
                }
            });
        }

        // Call accessibility enhancements after DOM load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(enhanceAccessibility, 100);
        });

        // =============================================================================
        // FINAL INITIALIZATION MESSAGE
        // =============================================================================

        console.log(`
        üç© Donuland Management System v2.0
        ===================================
        ‚úÖ Historick√° data: ${historicalData.length} akc√≠
        ‚úÖ Pl√°novan√© akce: ${plannedEvents.length} akc√≠  
        ‚úÖ AI predikce: Aktivn√≠
        ‚úÖ Poƒças√≠: Aktivn√≠
        ‚úÖ Kalend√°≈ô: Aktivn√≠
        ‚úÖ Export: Aktivn√≠
        
        Syst√©m je p≈ôipraven k pou≈æit√≠! üöÄ
        `);

    </script>
</body>
</html>
